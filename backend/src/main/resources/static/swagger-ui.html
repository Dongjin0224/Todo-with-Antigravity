<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Todo API - Swagger UI</title>
    <link rel="stylesheet" href="https://unpkg.com/swagger-ui-dist@5.11.0/swagger-ui.css">
    <style>
        body {
            margin: 0;
            padding: 0;
        }

        .swagger-ui .topbar {
            background-color: #1f2937;
        }

        .swagger-ui .info .title {
            color: #1f2937;
        }
    </style>
</head>

<body>
    <div id="swagger-ui"></div>
    <script src="https://unpkg.com/swagger-ui-dist@5.11.0/swagger-ui-bundle.js"></script>
    <script src="https://unpkg.com/swagger-ui-dist@5.11.0/swagger-ui-standalone-preset.js"></script>
    <script>
        window.onload = async function () {
            // OpenAPI 스펙 로드 후 Security Scheme 동적 추가
            const response = await fetch("/docs/openapi3.json");
            const spec = await response.json();

            // Security Scheme 추가
            if (!spec.components) {
                spec.components = {};
            }
            spec.components.securitySchemes = {
                bearerAuth: {
                    type: "http",
                    scheme: "bearer",
                    bearerFormat: "JWT",
                    description: "JWT Access Token을 입력하세요 (Bearer 접두사 불필요)"
                }
            };

            // 모든 경로에 security 적용 (login, signup, reissue 제외)
            const publicPaths = ['/api/auth/login', '/api/auth/signup', '/api/auth/reissue'];
            for (const path in spec.paths) {
                for (const method in spec.paths[path]) {
                    if (!publicPaths.includes(path)) {
                        spec.paths[path][method].security = [{ bearerAuth: [] }];
                    }
                }
            }

            SwaggerUIBundle({
                spec: spec,
                dom_id: '#swagger-ui',
                deepLinking: true,
                presets: [
                    SwaggerUIBundle.presets.apis,
                    SwaggerUIStandalonePreset
                ],
                plugins: [
                    SwaggerUIBundle.plugins.DownloadUrl
                ],
                layout: "StandaloneLayout",
                persistAuthorization: true
            });
        };
    </script>
</body>

</html>